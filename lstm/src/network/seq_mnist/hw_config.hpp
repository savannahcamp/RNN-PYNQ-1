#pragma once

#include "r_model_fw_bw.hpp"

#define NUMBER_OF_LUT_ETRIES_SIGMOID_1 256
#define NUMBER_OF_LUT_ETRIES_TANH_1 256

// Dot product WRI, WCI, WNI
typedef t_fixed_wr_ih t_fixed_wr;
typedef t_fixed_wc_ih t_fixed_wc;
typedef t_fixed_wn_ih t_fixed_wn;

typedef t_fixed_br_ih t_fixed_br;
typedef t_fixed_bc_ih t_fixed_bc;
typedef t_fixed_bn_ih t_fixed_bn;

typedef ap_fixed<16 ,8, AP_RND_ZERO, AP_WRAP> t_fixed_sum_wr;
typedef t_fixed_sum_wr t_fixed_mul_wgi;

typedef ap_fixed<16 ,8, AP_RND_ZERO, AP_WRAP> t_fixed_sum_wc;
typedef t_fixed_sum_wc t_fixed_mul_wgf;

typedef ap_fixed<16 ,8, AP_RND_ZERO, AP_WRAP> t_fixed_sum_wn;
typedef t_fixed_sum_wn t_fixed_mul_wgo;

// Hidden Layer
typedef ap_fixed<16 ,8, AP_RND_CONV, AP_SAT> t_fixed_state;
typedef t_fixed_state t_fixed_ci_gi_mul;

typedef ap_fixed<16 ,8, AP_RND_CONV, AP_SAT> t_fixed_gix_sum;
typedef ap_fixed<16 ,8, AP_RND_CONV, AP_SAT> t_fixed_gfx_sum;
typedef ap_fixed<16 ,8, AP_RND_CONV, AP_SAT> t_fixed_gox_sum;

typedef ap_ufixed<8, 0, AP_RND_ZERO, AP_WRAP> t_fixed_sigma_o;
typedef ap_fixed<8, 1, AP_RND_ZERO, AP_WRAP> t_fixed_tanh_o;

// LUT
typedef ap_ufixed<10 ,10, AP_RND_ZERO, AP_WRAP> t_fixed_lut_xi;

typedef ap_fixed<8, 4, AP_RND_ZERO, AP_WRAP>   t_fixed_lut_sigmoid_limit;
typedef ap_ufixed<8, 6, AP_RND_ZERO, AP_WRAP>  t_fixed_lut_sigmoid_recip_step;

typedef ap_fixed<8, 3, AP_RND_ZERO, AP_WRAP>   t_fixed_lut_tanh_limit;
typedef ap_ufixed<8, 6, AP_RND_ZERO, AP_WRAP>  t_fixed_lut_tanh_recip_step;

typedef ap_fixed<16 ,6, AP_RND_ZERO, AP_WRAP> t_fixed_lut_exp_limit;
typedef ap_fixed<16 ,7, AP_RND_ZERO, AP_WRAP> t_fixed_lut_exp_input_1;
typedef ap_ufixed<8 ,5, AP_RND_ZERO, AP_WRAP> t_fixed_lut_exp_recip_step;

// Dot product
typedef ap_fixed<OUTPUTACTIVATIONOUTPUTLAYERWIDTH,8, AP_RND_CONV, AP_WRAP> t_fixed_sum_fc;
typedef ap_fixed<PIXELWIDTH ,1, AP_RND_ZERO, AP_WRAP> t_fixed_image;
typedef ap_fixed<OUTPUTACTIVATIONHIDDENLAYERWIDTH ,1, AP_RND_CONV, AP_SAT> t_fixed_recurrent;

typedef t_fixed_sum_fc t_fixed_mul_fc;

// DATA STRUCTURES
struct maxx
{
	t_fixed_sum_fc value;
	ap_uint<NUMBER_OF_CLASSES_TYPEWIDTH> label;
};

// LUT FUNCTIONS
static t_fixed_sigma_o lut_sigmoid_1[NUMBER_OF_LUT_ETRIES_SIGMOID_1] = {
0.00781250,
0.00781250,
0.00781250,
0.00781250,
0.00781250,
0.00781250,
0.00781250,
0.00781250,
0.00781250,
0.00781250,
0.01171875,
0.01171875,
0.01171875,
0.01171875,
0.01171875,
0.01171875,
0.01171875,
0.01171875,
0.01171875,
0.01562500,
0.01562500,
0.01562500,
0.01562500,
0.01562500,
0.01562500,
0.01953125,
0.01953125,
0.01953125,
0.01953125,
0.01953125,
0.01953125,
0.02343750,
0.02343750,
0.02343750,
0.02343750,
0.02734375,
0.02734375,
0.02734375,
0.02734375,
0.03125000,
0.03125000,
0.03125000,
0.03515625,
0.03515625,
0.03515625,
0.03906250,
0.03906250,
0.03906250,
0.04296875,
0.04296875,
0.04687500,
0.04687500,
0.05078125,
0.05078125,
0.05468750,
0.05468750,
0.05859375,
0.05859375,
0.06250000,
0.06250000,
0.06640625,
0.07031250,
0.07031250,
0.07421875,
0.07812500,
0.07812500,
0.08203125,
0.08593750,
0.08984375,
0.08984375,
0.09375000,
0.09765625,
0.10156250,
0.10546875,
0.10937500,
0.11328125,
0.11718750,
0.12109375,
0.12500000,
0.12890625,
0.13281250,
0.14062500,
0.14453125,
0.14843750,
0.15234375,
0.16015625,
0.16406250,
0.16796875,
0.17578125,
0.17968750,
0.18750000,
0.19140625,
0.19921875,
0.20703125,
0.21093750,
0.21875000,
0.22656250,
0.23046875,
0.23828125,
0.24609375,
0.25390625,
0.26171875,
0.26953125,
0.27734375,
0.28515625,
0.29296875,
0.30078125,
0.30859375,
0.31640625,
0.32812500,
0.33593750,
0.34375000,
0.35156250,
0.36328125,
0.37109375,
0.37890625,
0.39062500,
0.39843750,
0.40625000,
0.41796875,
0.42578125,
0.43750000,
0.44531250,
0.45703125,
0.46484375,
0.47656250,
0.48437500,
0.49609375,
0.50390625,
0.51562500,
0.52343750,
0.53515625,
0.54296875,
0.55468750,
0.56250000,
0.57421875,
0.58203125,
0.59375000,
0.60156250,
0.60937500,
0.62109375,
0.62890625,
0.63671875,
0.64843750,
0.65625000,
0.66406250,
0.67187500,
0.68359375,
0.69140625,
0.69921875,
0.70703125,
0.71484375,
0.72265625,
0.73046875,
0.73828125,
0.74609375,
0.75390625,
0.76171875,
0.76953125,
0.77343750,
0.78125000,
0.78906250,
0.79296875,
0.80078125,
0.80859375,
0.81250000,
0.82031250,
0.82421875,
0.83203125,
0.83593750,
0.83984375,
0.84765625,
0.85156250,
0.85546875,
0.85937500,
0.86718750,
0.87109375,
0.87500000,
0.87890625,
0.88281250,
0.88671875,
0.89062500,
0.89453125,
0.89843750,
0.90234375,
0.90625000,
0.91015625,
0.91015625,
0.91406250,
0.91796875,
0.92187500,
0.92187500,
0.92578125,
0.92968750,
0.92968750,
0.93359375,
0.93750000,
0.93750000,
0.94140625,
0.94140625,
0.94531250,
0.94531250,
0.94921875,
0.94921875,
0.95312500,
0.95312500,
0.95703125,
0.95703125,
0.96093750,
0.96093750,
0.96093750,
0.96484375,
0.96484375,
0.96484375,
0.96875000,
0.96875000,
0.96875000,
0.97265625,
0.97265625,
0.97265625,
0.97265625,
0.97656250,
0.97656250,
0.97656250,
0.97656250,
0.98046875,
0.98046875,
0.98046875,
0.98046875,
0.98046875,
0.98046875,
0.98437500,
0.98437500,
0.98437500,
0.98437500,
0.98437500,
0.98437500,
0.98828125,
0.98828125,
0.98828125,
0.98828125,
0.98828125,
0.98828125,
0.98828125,
0.98828125,
0.98828125,
0.99218750,
0.99218750,
0.99218750,
0.99218750,
0.99218750,
0.99218750,
0.99218750,
0.99218750,
0.99218750,
0.99218750};

static t_fixed_tanh_o lut_tanh_1[NUMBER_OF_LUT_ETRIES_TANH_1] = {
-0.99218750,
-0.99218750,
-0.99218750,
-0.99218750,
-0.99218750,
-0.99218750,
-0.99218750,
-0.99218750,
-0.99218750,
-0.99218750,
-0.99218750,
-0.99218750,
-0.99218750,
-0.99218750,
-0.99218750,
-0.99218750,
-0.99218750,
-0.99218750,
-0.99218750,
-0.98437500,
-0.98437500,
-0.98437500,
-0.98437500,
-0.98437500,
-0.98437500,
-0.98437500,
-0.98437500,
-0.98437500,
-0.98437500,
-0.98437500,
-0.97656250,
-0.97656250,
-0.97656250,
-0.97656250,
-0.97656250,
-0.97656250,
-0.97656250,
-0.96875000,
-0.96875000,
-0.96875000,
-0.96875000,
-0.96875000,
-0.96875000,
-0.96093750,
-0.96093750,
-0.96093750,
-0.96093750,
-0.95312500,
-0.95312500,
-0.95312500,
-0.94531250,
-0.94531250,
-0.94531250,
-0.94531250,
-0.93750000,
-0.93750000,
-0.92968750,
-0.92968750,
-0.92968750,
-0.92187500,
-0.92187500,
-0.91406250,
-0.91406250,
-0.90625000,
-0.90625000,
-0.89843750,
-0.89843750,
-0.89062500,
-0.88281250,
-0.88281250,
-0.87500000,
-0.86718750,
-0.85937500,
-0.85937500,
-0.85156250,
-0.84375000,
-0.83593750,
-0.82812500,
-0.82031250,
-0.81250000,
-0.80468750,
-0.79687500,
-0.78906250,
-0.78125000,
-0.77343750,
-0.75781250,
-0.75000000,
-0.74218750,
-0.72656250,
-0.71875000,
-0.71093750,
-0.69531250,
-0.67968750,
-0.67187500,
-0.65625000,
-0.64062500,
-0.63281250,
-0.61718750,
-0.60156250,
-0.58593750,
-0.57031250,
-0.55468750,
-0.53906250,
-0.52343750,
-0.50000000,
-0.48437500,
-0.46875000,
-0.44531250,
-0.42968750,
-0.40625000,
-0.39062500,
-0.36718750,
-0.35156250,
-0.32812500,
-0.30468750,
-0.28906250,
-0.26562500,
-0.24218750,
-0.21875000,
-0.19531250,
-0.17187500,
-0.14843750,
-0.12500000,
-0.10937500,
-0.08593750,
-0.06250000,
-0.03906250,
-0.01562500,
0.01562500,
0.03906250,
0.06250000,
0.08593750,
0.10937500,
0.12500000,
0.14843750,
0.17187500,
0.19531250,
0.21875000,
0.24218750,
0.26562500,
0.28906250,
0.30468750,
0.32812500,
0.35156250,
0.36718750,
0.39062500,
0.40625000,
0.42968750,
0.44531250,
0.46875000,
0.48437500,
0.50000000,
0.52343750,
0.53906250,
0.55468750,
0.57031250,
0.58593750,
0.60156250,
0.61718750,
0.63281250,
0.64062500,
0.65625000,
0.67187500,
0.67968750,
0.69531250,
0.71093750,
0.71875000,
0.72656250,
0.74218750,
0.75000000,
0.75781250,
0.77343750,
0.78125000,
0.78906250,
0.79687500,
0.80468750,
0.81250000,
0.82031250,
0.82812500,
0.83593750,
0.84375000,
0.85156250,
0.85937500,
0.85937500,
0.86718750,
0.87500000,
0.88281250,
0.88281250,
0.89062500,
0.89843750,
0.89843750,
0.90625000,
0.90625000,
0.91406250,
0.91406250,
0.92187500,
0.92187500,
0.92968750,
0.92968750,
0.92968750,
0.93750000,
0.93750000,
0.94531250,
0.94531250,
0.94531250,
0.94531250,
0.95312500,
0.95312500,
0.95312500,
0.96093750,
0.96093750,
0.96093750,
0.96093750,
0.96875000,
0.96875000,
0.96875000,
0.96875000,
0.96875000,
0.96875000,
0.97656250,
0.97656250,
0.97656250,
0.97656250,
0.97656250,
0.97656250,
0.97656250,
0.98437500,
0.98437500,
0.98437500,
0.98437500,
0.98437500,
0.98437500,
0.98437500,
0.98437500,
0.98437500,
0.98437500,
0.98437500,
0.99218750,
0.99218750,
0.99218750,
0.99218750,
0.99218750,
0.99218750,
0.99218750,
0.99218750,
0.99218750,
0.99218750,
0.99218750,
0.99218750,
0.99218750,
0.99218750,
0.99218750,
0.99218750,
0.99218750,
0.99218750,
0.99218750};

void topLevel_BLSTM_CTC(ap_uint<32> number_of_columns,
				        ap_uint<32> number_of_columns_twice,
						ap_uint<32> number_bytes_read,
						ap_uint<DATAWIDTH> *input_buffer,
						ap_uint<DATAWIDTH> *output_buffer);
